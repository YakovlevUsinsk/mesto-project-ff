(()=>{"use strict";function e(e,t,n){e.classList.remove(t),e.setCustomValidity("");var o=document.querySelector(".".concat(e.id,"-error"));o.classList.remove(n),o.textContent=""}function t(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))}function n(n,o){var r=Array.from(n.querySelectorAll(o.inputSelector));r.forEach((function(t){t.value="",e(t,o.inputErrorClass,o.errorClass)})),t(r,n.querySelector(o.submitButtonSelector),o.inactiveButtonClass)}var o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-23",headers:{authorization:"524b66f3-5145-414f-bd77-15a854ae63ff","Content-Type":"application/json"}};function r(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function c(e,t){e.querySelector('button[type="submit"]').textContent=t?"Сохранить":"Сохранение..."}function a(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=c.querySelector(".card__image"),u=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button");return a.src=e.link,a.alt=e.name,u.textContent=e.name,i(e,r,s),a.addEventListener("click",(function(){return o(a)})),s.addEventListener("click",n),function(e,t){return e.owner._id===t}(e,r)?l.addEventListener("click",t):l.remove(),c}function i(e,t,n){!function(e,t){0!==e.length?t.textContent=e.length:t.textContent=""}(e.likes,n.parentElement.querySelector(".card__counter-like")),u(e.likes,t)?n.classList.add("card__like-button_is-active"):n.classList.remove("card__like-button_is-active")}function u(e,t){return 0!==e.lenght&&e.some((function(e){return e._id===t}))}function l(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)}function d(e){"Escape"===e.key&&s(document.querySelector(".popup_is-opened"))}var f,p,m,_,v,h,y,S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},b=document.querySelector(".places__list"),q=document.querySelectorAll(".popup"),E=document.querySelector(".popup_type_image"),k=document.querySelector(".profile__edit-button"),C=E.querySelector(".popup__image"),L=E.querySelector(".popup__caption"),g=document.querySelector(".popup_type_avatar"),x=document.querySelector(".popup_type_edit"),U=document.querySelector(".profile__add-button"),A=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),w=document.forms["edit-profile"],T=document.forms["new-place"],B=document.forms.avatar,D=document.querySelector(".popup_type_new-card"),N=document.querySelector(".profile__image"),O=document.querySelector(".wrapper");function j(e,t){var n;(n=e._id,fetch("".concat(o.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:o.headers}).then(r)).then((function(){!function(e){e.remove()}(t)})).catch((function(e){console.log(e)})).finally((function(){}))}function J(e,t,n){var c;u(e.likes,t)?(c=e._id,fetch("".concat(o.baseUrl,"/cards/likes/").concat(c),{method:"DELETE",headers:o.headers}).then(r)).then((function(o){e.likes=o.likes,i(e,t,n.querySelector(".card__like-button"))})).catch((function(e){console.log(e)})).finally((function(){})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then(r)}(e._id).then((function(o){e.likes=o.likes,i(e,t,n.querySelector(".card__like-button"))})).catch((function(e){console.log(e)})).finally((function(){}))}function M(e){C.src=e.src,C.alt=e.alt,L.textContent=e.alt,l(E)}U.addEventListener("click",(function(){T.reset(),n(D,S),l(D)})),q.forEach((function(e){return e.classList.add("popup_is-animated")})),q.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){s(e)}))})),q.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&s(e)}))})),T.addEventListener("submit",(function(e){e.preventDefault(),c(T,!1);var t,i={};i.name=T["place-name"].value,i.link=T.link.value,(t=i,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(t)}).then(r)).then((function(e){var t=a(e,(function(){j(e,t)}),(function(){J(e,z,t)}),M,z);b.prepend(t),s(D),T.reset(),n(D,S)})).catch((function(e){console.log(e)})).finally((function(){c(T,!0)}))})),w.addEventListener("submit",(function(e){var t;e.preventDefault(),c(w,!1),(t={name:w.name.value,about:w.description.value},fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify(t)}).then(r)).then((function(e){A.textContent=e.name,P.textContent=e.about,s(x)})).catch((function(e){console.log(e)})).finally((function(){c(w,!0)}))})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),c(g,!1),(t={avatar:B["link-avatar"].value},fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify(t)}).then(r)).then((function(e){N.src=e.avatar,s(g)})).catch((function(e){console.log(res)})).finally((function(){c(g,!0)}))})),k.addEventListener("click",(function(){w.name.value=A.textContent,w.description.value=P.textContent,l(x)})),O.addEventListener("click",(function(){n(B,S),l(g)})),f=(y=S).formSelector,p=y.inputSelector,m=y.submitButtonSelector,_=y.inactiveButtonClass,v=y.inputErrorClass,h=y.errorClass,Array.from(document.querySelectorAll(f)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()}));var o=Array.from(n.querySelectorAll(p)),r=n.querySelector(m);o.forEach((function(n){n.addEventListener("input",(function(){(function(t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?e(t,n,o):function(e,t,n,o){e.classList.add(n);var r=document.querySelector(".".concat(e.id,"-error"));r.classList.add(o),r.textContent=t}(t,t.validationMessage,n,o)})(n,v,h),t(o,r,_)}))}))}));var V=fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(r),H=fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(r),z=null;Promise.all([H,V]).then((function(e){var t=e[1],n={name:e[0].name,about:e[0].about};return z=e[0]._id,N.src=e[0].avatar,{arrayCard:t,dataProfile:n}})).then((function(e){e.arrayCard.forEach((function(e){var t=a(e,(function(){j(e,t)}),(function(){J(e,z,t)}),M,z);b.append(t)})),A.textContent=e.dataProfile.name,P.textContent=e.dataProfile.about})).catch((function(e){console.log(e)}))})();